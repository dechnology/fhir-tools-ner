MODEL=mlx-community/Meta-Llama-3.1-8B-Instruct-4bit

LLM_PROMPT='[INST] Detect LOINC terms from the following laboratory report content and output them as a JSON array according to the schema: {"type": "object", "properties": {"LOINC_Terms": {"type": "array", "items": {"type": "string"}}}}. Do not explain the result, just output it. Input: "Laboratory Report *********Lab: RL*********** Group: CBC+PLT White Blood Cell (WBC) Red Blood Cell (RBC) Hemoglobin (HB) Hematocrit (HCT) Mean Corpuscular Volume (MCV) Time/Item (Thousand/μL) (Million/μL) (g/dL) (%) (fL) 1060225 [1333] 60.52 2.96 8.4 25.3 85.5 1060226 [0640] 27.08 2.94 8.3 24.7 84.0 1060228 [0633] 3.76 2.79 8.1 23.7 84.9 Mean Corpuscular Hemoglobin (MCH) Mean Corpuscular Hemoglobin Concentration (MCHC) Platelet (PLT) Red Cell Distribution Width - Coefficient of Variation (RDW-CV) Peripheral Smear (PS) Time/Item (pg) (g/dL) (Thousand/μL) (%) ()1060225 [1333] 28.4% 33.2% 54% 20.6% - 1060226 [0640] 28.2% 33.6% 48% 20.4% - 1060228 [0633] 29.0% 34.2% 30% 19.3% - Group: White Blood Cell (WBC) Classification Blasts Promyelocytes Myelocytes Metamyelocytes Bands time/item (%) (%) (%) (%) (%) 1060225 [1333] 0.0% 0.0% 0.0% 0.0% 0.0% 1060226 [0640] 0.0% 0.0% 0.0% 0.0% 0.0% 1060228 [0633] 0.0% 0.0% 0.0% 0.0% 0.0% Segmented Eosinophils Basophils Monocytes Lymphocytes Time/Item (%) (%) (%) (%) (%) 1060225 [1333] * 0.0 0.7 0.2 * 0.0 * 0.0 1060226 [0640] * 0.0 1.4 0.1 * 0.0 * 0.0 1060228 [0633] 56.3 2.1 0.3 16.8 24.5 Atypical Lymphocytes Plasma Cells Normoblasts Pseudoeosinophils Time/Item (%) (%) (Count) 1060225 [1333] 0.0 0.0 0 For Reference Only 1060226 [0640] 0.0 0.0 0 For Reference Only 1060228 [0633] 0.0 0.0 0 For Reference Only". [/INST]'

LLM_SCHEMA='{"type": "object", "properties": {"snomedctTerms": {"type": "array", "items": {"type": "string"}}}}'

python3 -m examples.llm_schema --model-path $MODEL --prompt "$LLM_PROMPT" --schema "$LLM_SCHEMA" --max-tokens 16384 --repeat-prompt
